<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShopSpot Premium</title>
    <style>
        :root {
            --primary: #2563eb;       
            --bg: #f8fafc;            
            --surface: #ffffff;
            --text-main: #1e293b;     
            --text-sub: #64748b;      
            --border: #e2e8f0;
            --danger: #ef4444;
            --success: #10b981;
            --gray-hover: #f1f5f9;
            --gray-active: #e2e8f0;
            
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            margin: 0; padding: 0; 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: var(--bg); color: var(--text-main); 
            min-height: 100vh;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* Header */
        header { 
            background: var(--surface); padding: 15px 20px; 
            position: sticky; top: 0; z-index: 50; 
            display: flex; align-items: center; justify-content: center;
            border-bottom: 1px solid var(--border);
        }
        h1 { font-size: 1.1rem; font-weight: 700; margin: 0; letter-spacing: -0.01em; }
        .btn-icon { position: absolute; left: 15px; background: transparent; border: none; padding: 8px; border-radius: 50%; color: var(--text-main); cursor: pointer; }

        /* Tabs */
        .tab-wrapper { padding: 15px 20px 5px; background: var(--bg); }
        .tabs { background: #e2e8f0; padding: 4px; border-radius: 12px; display: flex; }
        .tab { flex: 1; border: none; background: transparent; padding: 8px; font-size: 0.85rem; font-weight: 600; color: var(--text-sub); border-radius: 9px; cursor: pointer; transition: 0.2s; }
        .tab.active { background: var(--surface); color: var(--text-main); box-shadow: var(--shadow-sm); }

        /* Container */
        .container { max-width: 600px; margin: 0 auto; padding: 15px 20px; }
        .hidden { display: none !important; }

        /* --- Input Bar (Floating & Responsive) --- */
        .input-wrapper {
            background: var(--surface);
            padding: 8px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            display: flex; gap: 8px; margin-bottom: 25px; align-items: center;
            border: 1px solid var(--border);
            position: relative;
            z-index: 40;
            flex-wrap: nowrap;
        }
        .clean-input {
            border: none; background: transparent; padding: 12px;
            font-size: 0.95rem; color: var(--text-main); border-radius: 12px;
        }
        .clean-input:focus { background: var(--bg); }
        #inName { flex: 2; padding-left: 15px; font-weight: 500; min-width: 0; }
        #inQty { width: 85px; text-align: center; flex-shrink: 0; } 

        @media (max-width: 480px) {
            .input-wrapper { flex-wrap: wrap; padding: 12px; border-radius: 24px; gap: 10px; }
            #inName { flex: 1 1 100%; border-bottom: 1px solid var(--gray-active); border-radius: 12px 12px 4px 4px; margin-bottom: 2px; }
            #inQty { flex: 1; background: var(--bg); }
            .custom-dd-container { flex: 1; }
            .custom-dd-trigger { background: var(--bg); }
        }

        /* --- CUSTOM GRAY DROPDOWN --- */
        .custom-dd-container { position: relative; width: 75px; height: 42px; flex-shrink: 0; }
        .custom-dd-trigger {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center; gap: 4px;
            background: var(--bg); border-radius: 12px;
            font-size: 0.9rem; font-weight: 600; color: var(--text-main);
            cursor: pointer; transition: background 0.2s;
        }
        .custom-dd-trigger:hover { background: #e2e8f0; }
        .custom-dd-trigger svg { width: 14px; height: 14px; color: var(--text-sub); }
        .custom-dd-menu {
            position: absolute; top: 50px; left: 0; width: 100%;
            background: var(--surface); border-radius: 12px;
            box-shadow: var(--shadow-lg); border: 1px solid var(--border);
            padding: 5px; opacity: 0; pointer-events: none; transform: translateY(-10px);
            transition: 0.2s; z-index: 100;
        }
        .custom-dd-menu.open { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .custom-option {
            padding: 8px 10px; border-radius: 8px; font-size: 0.9rem;
            color: var(--text-main); cursor: pointer; text-align: center;
            transition: background 0.1s;
        }
        .custom-option:hover { background-color: var(--gray-hover); }
        .custom-option.selected { background-color: var(--gray-active); font-weight: 700; }

        /* Add Button */
        .btn-add {
            background: var(--text-main); color: white; border: none;
            width: 42px; height: 42px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; flex-shrink: 0; transition: 0.2s;
        }
        .btn-add:active { transform: scale(0.95); }

        /* --- List Cards --- */
        .list-card { 
            background: var(--surface); border-radius: var(--radius); 
            padding: 20px; margin-bottom: 15px; 
            box-shadow: var(--shadow-sm); border: 1px solid var(--border);
            cursor: pointer; transition: transform 0.1s;
            position: relative;
        }
        .list-card:active { transform: scale(0.98); }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 700; padding-right: 30px; }
        .card-meta { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-sub); }
        .card-del-btn {
            position: absolute; top: 15px; right: 15px;
            background: transparent; border: none;
            color: #94a3b8; cursor: pointer; padding: 5px;
            border-radius: 50%; transition: 0.2s;
            z-index: 5;
        }
        .card-del-btn:hover { background: #fee2e2; color: var(--danger); }
        .card-del-btn svg { width: 18px; height: 18px; }

        /* --- Items Grid --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
        .item-card { 
            background: var(--surface); border-radius: 16px; padding: 15px; 
            position: relative; display: flex; flex-direction: column; 
            border: 1px solid transparent; box-shadow: var(--shadow-sm);
        }
        .item-card.bought { background: #f8fafc; opacity: 0.7; }
        .checkbox-overlay {
            position: absolute; top: 10px; right: 10px;
            width: 24px; height: 24px;
            border: 2px solid var(--border); border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            background: var(--surface); transition: 0.2s;
        }
        .item-card.bought .checkbox-overlay { background: var(--text-main); border-color: var(--text-main); }
        .checkbox-overlay svg { width: 14px; color: white; opacity: 0; transition: 0.2s; }
        .item-card.bought .checkbox-overlay svg { opacity: 1; }
        .item-name { font-weight: 600; margin-bottom: 4px; padding-right: 30px; word-break: break-word; }
        .item-meta { font-size: 0.85rem; color: var(--text-sub); }
        .price-wrapper { margin-top: 15px; background: var(--bg); padding: 6px 10px; border-radius: 8px; display: flex; align-items: center; }
        .price-input { background: transparent; border: none; width: 100%; font-weight: 700; font-size: 0.95rem; }
        .actions { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--bg); }
        .act-btn { flex: 1; border: none; background: transparent; padding: 6px; border-radius: 6px; cursor: pointer; color: var(--text-sub); font-size: 0.8rem; }
        .act-btn:hover { background: #e2e8f0; color: var(--text-main); }
        .act-btn.del:hover { background: #fee2e2; color: var(--danger); }

        .fab { position: fixed; bottom: 30px; right: 25px; background: var(--text-main); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-lg); border: none; cursor: pointer; z-index: 90; }

        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); padding: 15px 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; z-index: 40; border-top: 1px solid var(--border); }
        .btn-save { background: var(--text-main); color: white; border: none; padding: 12px 25px; border-radius: 30px; font-weight: 600; cursor: pointer; min-width: 100px; transition: background-color 0.3s; }

        /* --- Modals --- */
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 200; opacity: 0; pointer-events: none; transition: 0.2s; }
        .modal-bg.open { opacity: 1; pointer-events: auto; }
        .modal-card { background: var(--surface); width: 85%; max-width: 320px; border-radius: 24px; padding: 25px; box-shadow: var(--shadow-lg); transform: translateY(20px); transition: 0.2s; text-align: center; }
        .modal-bg.open .modal-card { transform: translateY(0); }
        .modal-input { width: 100%; padding: 12px; background: var(--bg); border: 1px solid transparent; border-radius: 12px; margin: 10px 0 20px; font-size: 1rem; text-align: left;}
        .modal-input:focus { background: white; border-color: var(--text-main); }
        .modal-btns { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .m-btn { padding: 10px 24px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; font-size: 0.95rem; }
        .m-btn.cancel { background: #f1f5f9; color: var(--text-main); }
        .m-btn.confirm { background: var(--text-main); color: white; }
        .m-btn.danger { background: var(--danger); color: white; }
        .confirm-msg { color: var(--text-sub); margin-bottom: 5px; line-height: 1.5; }

        /* --- AD WRAPPER STYLING --- */
        .ad-footer-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            /* Extra padding at bottom to clear the FAB and Save Bar */
            padding-bottom: 100px; 
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- HOME -->
    <div id="view-home">
        <header><h1>ShopSpot</h1></header>
        <div class="tab-wrapper">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('active')">My Lists</button>
                <button class="tab" onclick="switchTab('history')">History</button>
            </div>
        </div>
        <div class="container" id="list-container"></div>
        <button class="fab" onclick="showModal('modal-create')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
    </div>

    <!-- LIST VIEW -->
    <div id="view-list" class="hidden">
        <header>
            <button class="btn-icon" onclick="goHome()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <h1 id="list-title">List Name</h1>
        </header>

        <div class="container">
            <!-- INPUT BAR -->
            <div id="add-area" class="input-wrapper">
                <input type="text" id="inName" class="clean-input" placeholder="Item name...">
                <input type="number" id="inQty" class="clean-input" placeholder="Qty">
                
                <div class="custom-dd-container">
                    <div class="custom-dd-trigger" onclick="toggleUnitMenu()">
                        <span id="selectedUnitText">pcs</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                    <div class="custom-dd-menu" id="unitMenu">
                        <div class="custom-option selected" onclick="selectUnit('pcs')">pcs</div>
                        <div class="custom-option" onclick="selectUnit('kg')">kg</div>
                        <div class="custom-option" onclick="selectUnit('g')">g</div>
                        <div class="custom-option" onclick="selectUnit('L')">L</div>
                        <div class="custom-option" onclick="selectUnit('pkt')">pkt</div>
                    </div>
                </div>

                <button class="btn-add" onclick="addItem()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
            </div>

            <div id="grid-container" class="grid"></div>
        </div>

        <div class="footer-bar" id="footer-actions">
            <div>Total: <span id="total-price" style="font-weight:800; font-size:1.2rem; margin-left:5px;">$0.00</span></div>
            <button id="btn-save" class="btn-save" onclick="manualSave()">Save</button>
        </div>
    </div>

    <!-- AD CONTAINER (Appears at the bottom of content, above fixed footer) -->
    <div class="ad-footer-wrapper">
        <script async="async" data-cfasync="false" src="//pl28234684.effectivegatecpm.com/5eb16f1e33644e66b62e2b5a13db708c/invoke.js"></script>
        <div id="container-5eb16f1e33644e66b62e2b5a13db708c"></div>
    </div>

    <!-- CREATE LIST MODAL -->
    <div id="modal-create" class="modal-bg">
        <div class="modal-card">
            <h3>New List</h3>
            <input type="text" id="new-list-input" class="modal-input" placeholder="e.g. Weekly Groceries" autofocus>
            <div class="modal-btns">
                <button class="m-btn cancel" onclick="closeModals()">Cancel</button>
                <button class="m-btn confirm" onclick="createList()">Create</button>
            </div>
        </div>
    </div>

    <!-- EDIT ITEM MODAL -->
    <div id="modal-edit" class="modal-bg">
        <div class="modal-card">
            <h3>Edit Item</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="edit-name" class="modal-input" placeholder="Name" style="margin-bottom:10px">
            <div style="display:flex; gap:10px; margin-bottom:10px">
                <input type="number" id="edit-qty" class="modal-input" style="margin:0">
                <select id="edit-unit" class="modal-input" style="margin:0; width:100px;">
                    <option value="pcs">pcs</option>
                    <option value="kg">kg</option>
                    <option value="g">g</option>
                    <option value="L">L</option>
                    <option value="pkt">pkt</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="m-btn cancel" onclick="closeModals()">Cancel</button>
                <button class="m-btn confirm" onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>

    <!-- CUSTOM CONFIRM POPUP -->
    <div id="modal-confirm" class="modal-bg">
        <div class="modal-card">
            <h3 id="confirm-title" style="margin-top:0">Confirm</h3>
            <p id="confirm-msg" class="confirm-msg">Are you sure?</p>
            <div class="modal-btns">
                <button class="m-btn cancel" onclick="closeConfirm()">No</button>
                <button id="confirm-yes-btn" class="m-btn confirm">Yes</button>
            </div>
        </div>
    </div>

    <script>
        let appData = JSON.parse(localStorage.getItem('shopSpotProV5')) || { lists: [] };
        let currentTab = 'active';
        let activeListId = null;
        let currentUnit = 'pcs';
        let confirmCallback = null;

        document.addEventListener('DOMContentLoaded', () => {
            renderHome();
            document.addEventListener('click', (e) => {
                const dd = document.querySelector('.custom-dd-container');
                if (dd && !dd.contains(e.target)) {
                    document.getElementById('unitMenu').classList.remove('open');
                }
            });
        });

        function save() { localStorage.setItem('shopSpotProV5', JSON.stringify(appData)); }

        // --- Custom Confirm Logic ---
        function showCustomConfirm(title, msg, isDanger, callback) {
            document.getElementById('confirm-title').innerText = title;
            document.getElementById('confirm-msg').innerText = msg;
            const btn = document.getElementById('confirm-yes-btn');
            if(isDanger) {
                btn.className = 'm-btn danger';
                btn.innerText = 'Delete';
            } else {
                btn.className = 'm-btn confirm';
                btn.innerText = 'Yes';
            }
            confirmCallback = callback;
            document.getElementById('modal-confirm').classList.add('open');
        }
        function closeConfirm() {
            document.getElementById('modal-confirm').classList.remove('open');
            confirmCallback = null;
        }
        document.getElementById('confirm-yes-btn').addEventListener('click', () => {
            if (confirmCallback) confirmCallback();
            closeConfirm();
        });

        // --- Dropdown Logic ---
        function toggleUnitMenu() {
            document.getElementById('unitMenu').classList.toggle('open');
        }
        function selectUnit(val) {
            currentUnit = val;
            document.getElementById('selectedUnitText').innerText = val;
            document.querySelectorAll('.custom-option').forEach(el => {
                el.classList.remove('selected');
                if(el.innerText === val) el.classList.add('selected');
            });
            document.getElementById('unitMenu').classList.remove('open');
        }

        // --- Nav ---
        function switchTab(t) {
            currentTab = t;
            document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
            if(t === 'active') document.querySelector('.tab:first-child').classList.add('active');
            else document.querySelector('.tab:last-child').classList.add('active');
            document.querySelector('.fab').style.display = t === 'active' ? 'flex' : 'none';
            renderHome();
        }
        function goHome() {
            document.getElementById('view-list').classList.add('hidden');
            document.getElementById('view-home').classList.remove('hidden');
            activeListId = null;
            renderHome();
        }

        // --- Render Home ---
        function renderHome() {
            const container = document.getElementById('list-container');
            container.innerHTML = '';
            
            const lists = appData.lists.filter(l => l.status === currentTab).sort((a,b) => b.id - a.id);

            if(lists.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding-top:60px; color:var(--text-sub);">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path></svg>
                    <p>${currentTab === 'active' ? 'No lists yet.' : 'No history.'}</p>
                </div>`;
                return;
            }

            lists.forEach(list => {
                const total = list.items.reduce((s, i) => s + (i.bought ? (parseFloat(i.price)||0) : 0), 0);
                const count = list.items.filter(i => i.bought).length;
                
                const div = document.createElement('div');
                div.className = 'list-card';
                div.onclick = () => openList(list.id);
                div.innerHTML = `
                    <button class="card-del-btn" onclick="deleteList(event, ${list.id})">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                    <div class="card-header">
                        <span>${list.name}</span>
                        <span style="font-weight:400; color:var(--text-sub); font-size:0.8rem">${new Date(list.id).toLocaleDateString()}</span>
                    </div>
                    <div class="card-meta">
                        <span>${count}/${list.items.length} bought</span>
                        <span style="font-weight:700; color:var(--text-main); font-size:1rem">$${total.toFixed(2)}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- List Actions ---
        function deleteList(e, id) {
            e.stopPropagation();
            const listIndex = appData.lists.findIndex(l => l.id === id);
            if(listIndex === -1) return;
            
            if (currentTab === 'active') {
                showCustomConfirm("Archive List", "Move this list to History?", false, () => {
                    appData.lists[listIndex].status = 'history';
                    save();
                    renderHome();
                });
            } else {
                showCustomConfirm("Delete List", "Permanently delete this record?", true, () => {
                    appData.lists.splice(listIndex, 1);
                    save();
                    renderHome();
                });
            }
        }

        function openList(id) {
            activeListId = id;
            const list = appData.lists.find(l => l.id === id);
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-list').classList.remove('hidden');
            document.getElementById('list-title').innerText = list.name;
            
            const isHistory = list.status === 'history';
            document.getElementById('add-area').style.display = isHistory ? 'none' : 'flex';
            document.getElementById('footer-actions').style.display = isHistory ? 'none' : 'flex';
            renderItems();
        }

        function addItem() {
            const name = document.getElementById('inName').value;
            if(!name) return;
            const list = appData.lists.find(l => l.id === activeListId);
            list.items.push({
                id: Date.now(), name,
                qty: document.getElementById('inQty').value || 1,
                unit: currentUnit,
                price: 0, bought: false
            });
            save(); renderItems();
            document.getElementById('inName').value = '';
            document.getElementById('inQty').value = '';
            document.getElementById('inName').focus();
        }

        function renderItems() {
            const list = appData.lists.find(l => l.id === activeListId);
            const container = document.getElementById('grid-container');
            const isHistory = list.status === 'history';
            container.innerHTML = '';
            let total = 0;

            list.items.forEach(item => {
                if(item.bought) total += parseFloat(item.price || 0);
                const el = document.createElement('div');
                el.className = `item-card ${item.bought ? 'bought' : ''}`;
                el.innerHTML = `
                    <div class="checkbox-overlay" onclick="${!isHistory ? `toggleBought(${item.id})` : ''}">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-meta">${item.qty} ${item.unit}</div>
                    <div class="price-wrapper">
                        <span style="color:var(--text-sub); margin-right:4px; font-size:0.8rem">$</span>
                        <input type="number" step="0.01" class="price-input" 
                            placeholder="0.00" value="${item.price || ''}" 
                            onchange="updatePrice(${item.id}, this.value)"
                            ${!item.bought || isHistory ? 'disabled' : ''}>
                    </div>
                    ${!isHistory ? `
                    <div class="actions">
                        <button class="act-btn" onclick="openEdit(${item.id})">Edit</button>
                        <button class="act-btn del" onclick="delItem(${item.id})">Del</button>
                    </div>` : ''}
                `;
                container.appendChild(el);
            });
            document.getElementById('total-price').innerText = '$' + total.toFixed(2);
        }

        function toggleBought(id) {
            const list = appData.lists.find(l => l.id === activeListId);
            const item = list.items.find(i => i.id === id);
            item.bought = !item.bought;
            save(); renderItems();
        }
        function updatePrice(id, val) {
            const list = appData.lists.find(l => l.id === activeListId);
            const item = list.items.find(i => i.id === id);
            item.price = parseFloat(val) || 0;
            save(); 
            const t = list.items.reduce((s, i) => s + (i.bought ? (parseFloat(i.price)||0) : 0), 0);
            document.getElementById('total-price').innerText = '$' + t.toFixed(2);
        }
        function delItem(id) {
            showCustomConfirm("Delete Item", "Remove this item?", true, () => {
                const list = appData.lists.find(l => l.id === activeListId);
                list.items = list.items.filter(i => i.id !== id);
                save(); renderItems();
            });
        }

        function createList() {
            const name = document.getElementById('new-list-input').value.trim();
            if(!name) return;
            const newList = { id: Date.now(), name, status: 'active', items: [] };
            appData.lists.push(newList);
            save(); closeModals(); openList(newList.id);
        }

        // --- NEW MANUAL SAVE FUNCTION ---
        function manualSave() {
            save(); 
            const btn = document.getElementById('btn-save');
            const originalText = btn.innerText;
            btn.innerText = "Saved! âœ“";
            btn.style.backgroundColor = "var(--success)";
            setTimeout(() => {
                btn.innerText = originalText;
                btn.style.backgroundColor = "var(--text-main)";
            }, 1200);
        }

        function openEdit(id) {
            const list = appData.lists.find(l => l.id === activeListId);
            const item = list.items.find(i => i.id === id);
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-name').value = item.name;
            document.getElementById('edit-qty').value = item.qty;
            document.getElementById('edit-unit').value = item.unit;
            showModal('modal-edit');
        }
        function saveEdit() {
            const id = parseInt(document.getElementById('edit-id').value);
            const list = appData.lists.find(l => l.id === activeListId);
            const item = list.items.find(i => i.id === id);
            item.name = document.getElementById('edit-name').value;
            item.qty = document.getElementById('edit-qty').value;
            item.unit = document.getElementById('edit-unit').value;
            save(); renderItems(); closeModals();
        }

        function showModal(id) {
            document.getElementById(id).classList.add('open');
            if(id === 'modal-create') setTimeout(() => document.getElementById('new-list-input').focus(), 100);
        }
        function closeModals() {
            document.querySelectorAll('.modal-bg').forEach(e => e.classList.remove('open'));
        }
    </script>
</body>
</html>
